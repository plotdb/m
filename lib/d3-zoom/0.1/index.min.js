!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],e):e(t.d3_zoom=t.d3_zoom||{},t.d3_dispatch,t.d3_drag,t.d3_interpolate,t.d3_selection,t.d3_transition)}(this,function(t,e,n,o,i,r){"use strict";function u(t){return function(){return t}}function h(t,e,n){this.target=t,this.type=e,this.transform=n}function s(t,e,n){this.k=t,this.x=e,this.y=n}function c(t){return t&&t.__zoom||y}function a(){i.event.stopImmediatePropagation()}function f(){i.event.preventDefault(),i.event.stopImmediatePropagation()}function l(){return!i.event.button}function m(){var t=this.ownerSVGElement||this;return[t.clientWidth,t.clientHeight]}function p(){return this.__zoom||y}function d(t){function c(t){t.on("wheel.zoom",w).on("mousedown.zoom",k).on("dblclick.zoom",x).on("touchstart.zoom",T).on("touchmove.zoom",b).on("touchend.zoom touchcancel.zoom",q).style("-webkit-tap-highlight-color","rgba(0,0,0,0)").property("__zoom",p)}function d(t){return function(){var e="function"==typeof t?t.apply(this,arguments):t;if(I>e.k||e.k>P){var n=(n=D.apply(this,arguments),[n[0]/2,n[1]/2]),o=e.invert(n);e=y(v(e,e.k),n,o)}return e}}function v(t,e){return new s(Math.max(I,Math.min(P,e)),t.x,t.y)}function y(t,e,n){return n=t.apply(n),new s(t.k,t.x+e[0]-n[0],t.y+e[1]-n[1])}function z(t,e,n){t.on("start.zoom",function(){_(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){_(this,arguments).end()}).tween("zoom:zoom",function(){var t=this,i=arguments,r=_(t,i),u=D.apply(t,i),h=n||[u[0]/2,u[1]/2],c=Math.max(u[0],u[1]),a=t.__zoom,f="function"==typeof e?e.apply(t,i):e,l=o.interpolateZoom(a.invert(h).concat(c/a.k),f.invert(h).concat(c/f.k));return function(t){if(1===t)t=f;else{var e=l(t),n=c/e[2];t=new s(n,h[0]-e[0]*n,h[1]-e[1]*n)}r.zoom(null,t)}})}function _(t,e){for(var n,o=0,i=j.length;i>o;++o)if((n=j[o]).that===t)return n;return new g(t,e)}function g(t,e){this.that=t,this.args=e,this.index=-1,this.active=0}function w(){function t(){X=null,delete o.wheel,o.end()}if(B.apply(this,arguments)){var e,n,o=_(this,arguments),u=-i.event.deltaY*(i.event.deltaMode?120:1)/500,h=this.__zoom,s=h.k;0===u||0>u&&s===I||u>0&&s===P||(o.wheel?(e=o.wheel[0],n=o.wheel[1],clearTimeout(X)):(o.wheel=[e=i.mouse(this),n=h.invert(e)],r.interrupt(this),o.start()),f(),X=setTimeout(t,K),o.zoom("wheel",y(v(h,s*Math.pow(2,u)),e,n)))}}function k(){function t(){f(),M=!0,o.zoom("mouse",y(o.that.__zoom,o.mouse[0]=i.mouse(o.that),o.mouse[1]))}function e(){u.on("mousemove.zoom mouseup.zoom",null),n.dragEnable(i.event.view,M),f(),delete o.mouse,o.end()}if(!E&&B.apply(this,arguments)){var o=_(this,arguments),u=i.select(i.event.view).on("mousemove.zoom",t,!0).on("mouseup.zoom",e,!0),h=i.mouse(this),s=this.__zoom.invert(h);n.dragDisable(i.event.view),a(),M=!1,o.mouse=[h,s],r.interrupt(this),o.start()}}function x(){if(B.apply(this,arguments)){var t=this.__zoom,e=i.mouse(this),n=t.invert(e),o=t.k*(i.event.shiftKey?.5:2),r=y(v(t,o),e,n);f(),S>0?i.select(this).transition().duration(S).call(z,r,e):i.select(this).call(c.transform,r)}}function T(){if(B.apply(this,arguments)){var t,e,n,o=_(this,arguments),u=i.event.changedTouches,h=u.length;for(a(),t=0;h>t;++t)e=u[t],n=i.touch(this,u,e.identifier),n=[n,this.__zoom.invert(n),e.identifier],o.touch0?o.touch1||(o.touch1=n):o.touch0=n;return Y&&(Y=clearTimeout(Y),!o.touch1)?(o.end(),x.apply(this,arguments)):void(i.event.touches.length===h&&(Y=setTimeout(function(){Y=null},H),r.interrupt(this),o.start()))}}function b(){var t,e,n,o,r=_(this,arguments),u=i.event.changedTouches,h=u.length;for(f(),Y&&(Y=clearTimeout(Y)),t=0;h>t;++t)e=u[t],n=i.touch(this,u,e.identifier),r.touch0&&r.touch0[2]===e.identifier?r.touch0[0]=n:r.touch1&&r.touch1[2]===e.identifier&&(r.touch1[0]=n);if(e=r.that.__zoom,r.touch1){var s=r.touch0[0],c=r.touch0[1],a=r.touch1[0],l=r.touch1[1],m=(m=a[0]-s[0])*m+(m=a[1]-s[1])*m,p=(p=l[0]-c[0])*p+(p=l[1]-c[1])*p;e=v(e,Math.sqrt(m/p)),n=[(s[0]+a[0])/2,(s[1]+a[1])/2],o=[(c[0]+l[0])/2,(c[1]+l[1])/2]}else{if(!r.touch0)return;n=r.touch0[0],o=r.touch0[1]}r.zoom("touch",y(e,n,o))}function q(){var t,e,n=_(this,arguments),o=i.event.changedTouches,r=o.length;for(a(),E&&clearTimeout(E),E=setTimeout(function(){E=null},H),t=0;r>t;++t)e=o[t],n.touch0&&n.touch0[2]===e.identifier?delete n.touch0:n.touch1&&n.touch1[2]===e.identifier&&delete n.touch1;n.touch1&&!n.touch0&&(n.touch0=n.touch1,delete n.touch1),n.touch0||n.end()}var M,Y,E,X,B=l,D=m,I=0,P=1/0,S=250,j=[],G=e.dispatch("start","zoom","end").on("start",t),H=500,K=150;return c.transform=function(t,e){var n=t.selection?t.selection():t;e=d(e),n.property("__zoom",p),t!==n?z(t,e):n.interrupt().each(function(){_(this,arguments).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()})},c.scaleBy=function(t,e){c.scaleTo(t,function(){var t=this.__zoom.k,n="function"==typeof e?e.apply(this,arguments):e;return t*n})},c.scaleTo=function(t,e){c.transform(t,function(){var t=this.__zoom,n=(n=D.apply(this,arguments),[n[0]/2,n[1]/2]),o=t.invert(n),i="function"==typeof e?e.apply(this,arguments):e;return y(v(t,i),n,o)})},c.translateBy=function(t,e,n){c.transform(t,function(){return this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n)})},g.prototype={start:function(){return 1===++this.active&&(this.index=j.push(this)-1,this.emit("start")),this},zoom:function(t,e){return this.wheel&&"wheel"!==t&&(this.wheel[1]=e.invert(this.wheel[0])),this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0===--this.active&&(j.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(t){i.customEvent(new h(c,t,this.that.__zoom),G.apply,G,[t,this.that,this.args])}},c.filter=function(t){return arguments.length?(B="function"==typeof t?t:u(!!t),c):B},c.size=function(t){return arguments.length?(D="function"==typeof t?t:u([+t[0],+t[1]]),c):D},c.scaleExtent=function(t){return arguments.length?(I=+t[0],P=+t[1],c):[I,P]},c.duration=function(t){return arguments.length?(S=+t,c):S},c.on=function(){var t=G.on.apply(G,arguments);return t===G?c:t},c}var v="0.1.0";s.prototype={constructor:s,scale:function(t){return 1===t?this:new s(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new s(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var y=new s(1,0,0);c.prototype=s.prototype,t.version=v,t.zoom=d,t.zoomTransform=c});