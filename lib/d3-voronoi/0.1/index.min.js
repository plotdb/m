!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("d3-voronoi",["exports"],t):t(e.d3_voronoi={})}(this,function(e){"use strict";function t(){this._=null}function n(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function i(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function r(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function s(e){for(;e.L;)e=e.L;return e}function u(e,t,n){this.edge=e,this.site=t,this.angle=n}function f(e,t,n){var i=e.a,r=e.b;return new u(e,t,n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y))}function a(e,t){return t.angle-e.angle}function l(e,t){this.l=e,this.r=t,this.a=this.b=null}function o(e,t,n,i){var r=new l(e,t);return H.push(r),n&&h(r,e,t,n),i&&h(r,t,e,i),F[e.i].edges.push(f(r,e,t)),F[t.i].edges.push(f(r,t,e)),r}function c(e,t,n){var i=new l(e,null);return i.a=t,i.b=n,H.push(i),i}function h(e,t,n,i){e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}function y(e,t,n,i,r){var s,u=e.a,f=e.b,a=u.x,l=u.y,o=f.x,c=f.y,h=0,y=1,x=o-a,v=c-l;if(s=t-a,x||!(s>0)){if(s/=x,0>x){if(h>s)return;y>s&&(y=s)}else if(x>0){if(s>y)return;s>h&&(h=s)}if(s=i-a,x||!(0>s)){if(s/=x,0>x){if(s>y)return;s>h&&(h=s)}else if(x>0){if(h>s)return;y>s&&(y=s)}if(s=n-l,v||!(s>0)){if(s/=v,0>v){if(h>s)return;y>s&&(y=s)}else if(v>0){if(s>y)return;s>h&&(h=s)}if(s=r-l,v||!(0>s)){if(s/=v,0>v){if(s>y)return;s>h&&(h=s)}else if(v>0){if(h>s)return;y>s&&(y=s)}return h>0&&(e.a={x:a+h*x,y:l+h*v}),1>y&&(e.b={x:a+y*x,y:l+y*v}),e}}}}}function x(e,t,n,i,r){var s=e.b;if(s)return!0;var u,f,a=e.a,l=e.l,o=e.r,c=l.x,h=l.y,y=o.x,x=o.y,v=(c+y)/2,g=(h+x)/2;if(x===h){if(t>v||v>=i)return;if(c>y){if(a){if(a.y>=r)return}else a={x:v,y:n};s={x:v,y:r}}else{if(a){if(a.y<n)return}else a={x:v,y:r};s={x:v,y:n}}}else if(u=(c-y)/(x-h),f=g-u*v,-1>u||u>1)if(c>y){if(a){if(a.y>=r)return}else a={x:(n-f)/u,y:n};s={x:(r-f)/u,y:r}}else{if(a){if(a.y<n)return}else a={x:(r-f)/u,y:r};s={x:(n-f)/u,y:n}}else if(x>h){if(a){if(a.x>=i)return}else a={x:t,y:u*t+f};s={x:i,y:u*i+f}}else{if(a){if(a.x<t)return}else a={x:i,y:u*i+f};s={x:t,y:u*t+f}}return e.a=a,e.b=s,!0}function v(e,t,n,i){for(var r,s=H.length;s--;)r=H[s],(!x(r,e,t,n,i)||!y(r,e,t,n,i)||Math.abs(r.a.x-r.b.x)<O&&Math.abs(r.a.y-r.b.y)<O)&&(r.a=r.b=null,H.splice(s,1))}function g(e){this.site=e,this.edges=[]}function C(e){return F[e.i]=new g(e)}function d(e,t,n,i){for(var r,s,u,a,l,o,h,y,x,v,g=F.length;g--;)if(l=F[g],l&&l.prepare())for(h=l.edges,y=h.length,o=0;y>o;)v=h[o].end(),u=v.x,a=v.y,x=h[++o%y].start(),r=x.x,s=x.y,(Math.abs(u-r)>O||Math.abs(a-s)>O)&&(h.splice(o,0,f(c(l.site,v,Math.abs(u-e)<O&&i-a>O?{x:e,y:Math.abs(r-e)<O?s:i}:Math.abs(a-i)<O&&n-u>O?{x:Math.abs(s-i)<O?r:n,y:i}:Math.abs(u-n)<O&&a-t>O?{x:n,y:Math.abs(r-n)<O?s:t}:Math.abs(a-t)<O&&u-e>O?{x:Math.abs(s-t)<O?r:e,y:t}:null),l.site,null)),++y)}function p(){n(this),this.x=this.y=this.arc=this.site=this.cy=null}function L(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,s=n.site;if(i!==s){var u=r.x,f=r.y,a=i.x-u,l=i.y-f,o=s.x-u,c=s.y-f,h=2*(a*c-l*o);if(!(h>=-Q)){var y=a*a+l*l,x=o*o+c*c,v=(c*y-l*x)/h,g=(a*x-o*y)/h,c=g+f,C=I.pop()||new p;C.arc=e,C.site=r,C.x=v+u,C.y=c+Math.sqrt(v*v+g*g),C.cy=c,e.circle=C;for(var d=null,L=G._;L;)if(C.y<L.y||C.y===L.y&&C.x<=L.x){if(!L.L){d=L.P;break}L=L.L}else{if(!L.R){d=L;break}L=L.R}G.insert(d,C),d||(B=C)}}}}function b(e){var t=e.circle;t&&(t.P||(B=t.N),G.remove(t),I.push(t),n(t),e.circle=null)}function R(){n(this),this.edge=this.site=this.circle=null}function M(e){var t=J.pop()||new R;return t.site=e,t}function U(e){b(e),D.remove(e),J.push(e),n(e)}function N(e){var t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},s=e.P,u=e.N,f=[e];U(e);for(var a=s;a.circle&&Math.abs(n-a.circle.x)<O&&Math.abs(i-a.circle.cy)<O;)s=a.P,f.unshift(a),U(a),a=s;f.unshift(a),b(a);for(var l=u;l.circle&&Math.abs(n-l.circle.x)<O&&Math.abs(i-l.circle.cy)<O;)u=l.N,f.push(l),U(l),l=u;f.push(l),b(l);var c,y=f.length;for(c=1;y>c;++c)l=f[c],a=f[c-1],h(l.edge,a.site,l.site,r);a=f[0],l=f[y-1],l.edge=o(a.site,l.site,null,r),L(a),L(l)}function P(e){for(var t,n,i,r,s=e.x,u=e.y,f=D._;f;)if(i=_(f,u)-s,i>O)f=f.L;else{if(r=s-m(f,u),!(r>O)){i>-O?(t=f.P,n=f):r>-O?(t=f,n=f.N):t=n=f;break}if(!f.R){t=f;break}f=f.R}C(e);var a=M(e);if(D.insert(t,a),t||n){if(t===n)return b(t),n=M(t.site),D.insert(a,n),a.edge=n.edge=o(t.site,a.site),L(t),void L(n);if(!n)return void(a.edge=o(t.site,a.site));b(t),b(n);var l=t.site,c=l.x,y=l.y,x=e.x-c,v=e.y-y,g=n.site,d=g.x-c,p=g.y-y,R=2*(x*p-v*d),U=x*x+v*v,N=d*d+p*p,P={x:(p*U-v*N)/R+c,y:(x*N-d*U)/R+y};h(n.edge,l,g,P),a.edge=o(l,e,null,P),n.edge=o(e,g,null,P),L(t),L(n)}}function _(e,t){var n=e.site,i=n.x,r=n.y,s=r-t;if(!s)return i;var u=e.P;if(!u)return-(1/0);n=u.site;var f=n.x,a=n.y,l=a-t;if(!l)return f;var o=f-i,c=1/s-1/l,h=o/l;return c?(-h+Math.sqrt(h*h-2*c*(o*o/(-2*l)-a+l/2+r-s/2)))/c+i:(i+f)/2}function m(e,t){var n=e.N;if(n)return _(n,t);var i=e.site;return i.y===t?i.x:1/0}function w(e){return e[0]}function k(e){return e[1]}function q(e){return function(){return e}}function A(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function E(e,t){return t.y-e.y||t.x-e.x}function j(e,n){var i,r,s,u=e.sort(E).pop();for(H=[],F=new Array(e.length),D=new t,G=new t;;)if(s=B,u&&(!s||u.y<s.y||u.y===s.y&&u.x<s.x))(u.x!==i||u.y!==r)&&(P(u),i=u.x,r=u.y),u=e.pop();else{if(!s)break;N(s.arc)}if(n){var i=n[0][0],r=n[0][1],f=n[1][0],a=n[1][1];v(i,r,f,a),d(i,r,f,a)}var l={cells:F,edges:H};return D=G=H=F=null,l}function z(){function e(e){var n=new Array(e.length),i=u[0][0],r=u[0][1],s=u[1][0],f=u[1][1];return j(t(e),u).cells.forEach(function(t,u){var a=t.edges,l=t.site,o=n[u]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):l.x>=i&&l.x<=s&&l.y>=r&&l.y<=f?[[i,f],[s,f],[s,r],[i,r]]:[];o.point=e[u]}),n}function t(e){return e.map(function(e,t){return{x:Math.round(r(e,t)/O)*O,y:Math.round(s(e,t)/O)*O,i:t}})}var n=w,i=k,r=n,s=i,u=K;return e.links=function(e){return j(t(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},e.triangles=function(e){var n=[];return j(t(e)).cells.forEach(function(t,i){for(var r,s,u=t.site,f=t.edges.sort(a),l=-1,o=f.length,c=f[o-1].edge,h=c.l===u?c.r:c.l;++l<o;)r=c,s=h,c=f[l].edge,h=c.l===u?c.r:c.l,i<s.i&&i<h.i&&A(u,s,h)<0&&n.push([e[i],e[s.i],e[h.i]])}),n},e.x=function(t){return arguments.length?(n=t,r="function"==typeof t?n:q(n),e):n},e.y=function(t){return arguments.length?(i=t,s="function"==typeof t?i:q(i),e):i},e.extent=function(t){return arguments.length?(u=null==t?K:t,e):u===K?null:u},e.size=function(t){return arguments.length?e.extent(t&&[[0,0],t]):u===K?null:u&&u[1]},e}t.prototype={insert:function(e,t){var n,u,f;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=s(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)u=n.U,n===u.L?(f=u.R,f&&f.C?(n.C=f.C=!1,u.C=!0,e=u):(e===n.R&&(i(this,n),e=n,n=e.U),n.C=!1,u.C=!0,r(this,u))):(f=u.L,f&&f.C?(n.C=f.C=!1,u.C=!0,e=u):(e===n.L&&(r(this,n),e=n,n=e.U),n.C=!1,u.C=!0,i(this,u))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,u,f=e.U,a=e.L,l=e.R;if(n=a?l?s(l):a:l,f?f.L===e?f.L=n:f.R=n:this._=n,a&&l?(u=n.C,n.C=e.C,n.L=a,a.U=n,n!==l?(f=n.U,n.U=e.U,e=n.R,f.L=e,n.R=l,l.U=n):(n.U=f,f=n,e=n.R)):(u=e.C,e=n),e&&(e.U=f),!u){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===f.L){if(t=f.R,t.C&&(t.C=!1,f.C=!0,i(this,f),t=f.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,r(this,t),t=f.R),t.C=f.C,f.C=t.R.C=!1,i(this,f),e=this._;break}}else if(t=f.L,t.C&&(t.C=!1,f.C=!0,r(this,f),t=f.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,i(this,t),t=f.L),t.C=f.C,f.C=t.L.C=!1,r(this,f),e=this._;break}t.C=!0,e=f,f=f.U}while(!e.C);e&&(e.C=!1)}}},u.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},g.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(a),t.length};var B,D,F,G,H,I=[],J=[],K=[[-1e6,-1e6],[1e6,1e6]],O=1e-6,Q=1e-12,S="0.1.0";e.version=S,e.voronoi=z});