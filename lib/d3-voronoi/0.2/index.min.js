!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("d3-voronoi",["exports"],t):t(e.d3_voronoi={})}(this,function(e){"use strict";function t(){this._=null}function n(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function i(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function r(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function f(e){for(;e.L;)e=e.L;return e}function u(e,t,n){this.edge=e,this.site=t,this.angle=n}function s(e){return e.edge[+(e.edge.right===e.site)]}function a(e){return e.edge[+(e.edge.left===e.site)]}function l(e,t,n){var i=e[0],r=e[1];return new u(e,t,n?Math.atan2(n[1]-t[1],n[0]-t[0]):e.left===t?Math.atan2(r[0]-i[0],i[1]-r[1]):Math.atan2(i[0]-r[0],r[1]-i[1]))}function o(e,t){return t.angle-e.angle}function h(e,t,n,i){var r=[null,null];return r.left=e,r.right=t,J.push(r),n&&g(r,e,t,n),i&&g(r,t,e,i),H[e.index].halfedges.push(l(r,e,t)),H[t.index].halfedges.push(l(r,t,e)),r}function c(e,t,n){var i=[t,n];return i.left=e,i.right=null,J.push(i),i}function g(e,t,n,i){e[0]||e[1]?e.left===n?e[1]=i:e[0]=i:(e[0]=i,e.left=t,e.right=n)}function d(e,t,n,i,r){var f,u=e[0],s=e[1],a=u[0],l=u[1],o=s[0],h=s[1],c=0,g=1,d=o-a,v=h-l;if(f=t-a,d||!(f>0)){if(f/=d,0>d){if(c>f)return;g>f&&(g=f)}else if(d>0){if(f>g)return;f>c&&(c=f)}if(f=i-a,d||!(0>f)){if(f/=d,0>d){if(f>g)return;f>c&&(c=f)}else if(d>0){if(c>f)return;g>f&&(g=f)}if(f=n-l,v||!(f>0)){if(f/=v,0>v){if(c>f)return;g>f&&(g=f)}else if(v>0){if(f>g)return;f>c&&(c=f)}if(f=r-l,v||!(0>f)){if(f/=v,0>v){if(f>g)return;f>c&&(c=f)}else if(v>0){if(c>f)return;g>f&&(g=f)}return c>0&&(e[0]=[a+c*d,l+c*v]),1>g&&(e[1]=[a+g*d,l+g*v]),e}}}}}function v(e,t,n,i,r){var f=e[1];if(f)return!0;var u,s,a=e[0],l=e.left,o=e.right,h=l[0],c=l[1],g=o[0],d=o[1],v=(h+g)/2,C=(c+d)/2;if(d===c){if(t>v||v>=i)return;if(h>g){if(a){if(a[1]>=r)return}else a=[v,n];f=[v,r]}else{if(a){if(a[1]<n)return}else a=[v,r];f=[v,n]}}else if(u=(h-g)/(d-c),s=C-u*v,-1>u||u>1)if(h>g){if(a){if(a[1]>=r)return}else a=[(n-s)/u,n];f=[(r-s)/u,r]}else{if(a){if(a[1]<n)return}else a=[(r-s)/u,r];f=[(n-s)/u,n]}else if(d>c){if(a){if(a[0]>=i)return}else a=[t,u*t+s];f=[i,u*i+s]}else{if(a){if(a[0]<t)return}else a=[i,u*i+s];f=[t,u*t+s]}return e[0]=a,e[1]=f,!0}function C(e,t,n,i){for(var r,f=J.length;f--;)r=J[f],(!v(r,e,t,n,i)||!d(r,e,t,n,i)||Math.abs(r[0][0]-r[1][0])<S&&Math.abs(r[0][1]-r[1][1])<S)&&(r[0]=r[1]=null,J.splice(f,1))}function L(e){this.site=e,this.halfedges=[]}function R(e){for(var t,n=e.halfedges,i=n.length;i--;)t=n[i].edge,t[1]&&t[0]||n.splice(i,1);return n.sort(o),n.length}function p(e){return H[e.index]=new L(e)}function b(e,t,n,i){for(var r,f,u,o,h,g,d,v,C,L,p=H.length;p--;)if(h=H[p],h&&R(h))for(d=h.halfedges,v=d.length,g=0;v>g;)L=a(d[g]),u=L[0],o=L[1],C=s(d[++g%v]),r=C[0],f=C[1],(Math.abs(u-r)>S||Math.abs(o-f)>S)&&(d.splice(g,0,l(c(h.site,L,Math.abs(u-e)<S&&i-o>S?[e,Math.abs(r-e)<S?f:i]:Math.abs(o-i)<S&&n-u>S?[Math.abs(f-i)<S?r:n,i]:Math.abs(u-n)<S&&o-t>S?[n,Math.abs(r-n)<S?f:t]:Math.abs(o-t)<S&&u-e>S?[Math.abs(f-t)<S?r:e,t]:null),h.site,null)),++v)}function y(){n(this),this.x=this.y=this.arc=this.site=this.cy=null}function M(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,f=n.site;if(i!==f){var u=r[0],s=r[1],a=i[0]-u,l=i[1]-s,o=f[0]-u,h=f[1]-s,c=2*(a*h-l*o);if(!(c>=-T)){var g=a*a+l*l,d=o*o+h*h,v=(h*g-l*d)/c,C=(a*d-o*g)/c,h=C+s,L=K.pop()||new y;L.arc=e,L.site=r,L.x=v+u,L.y=h+Math.sqrt(v*v+C*C),L.cy=h,e.circle=L;for(var R=null,p=I._;p;)if(L.y<p.y||L.y===p.y&&L.x<=p.x){if(!p.L){R=p.P;break}p=p.L}else{if(!p.R){R=p;break}p=p.R}I.insert(R,L),R||(F=L)}}}}function U(e){var t=e.circle;t&&(t.P||(F=t.N),I.remove(t),K.push(t),n(t),e.circle=null)}function x(){n(this),this.edge=this.site=this.circle=null}function N(e){var t=O.pop()||new x;return t.site=e,t}function P(e){U(e),G.remove(e),O.push(e),n(e)}function _(e){var t=e.circle,n=t.x,i=t.cy,r=[n,i],f=e.P,u=e.N,s=[e];P(e);for(var a=f;a.circle&&Math.abs(n-a.circle.x)<S&&Math.abs(i-a.circle.cy)<S;)f=a.P,s.unshift(a),P(a),a=f;s.unshift(a),U(a);for(var l=u;l.circle&&Math.abs(n-l.circle.x)<S&&Math.abs(i-l.circle.cy)<S;)u=l.N,s.push(l),P(l),l=u;s.push(l),U(l);var o,c=s.length;for(o=1;c>o;++o)l=s[o],a=s[o-1],g(l.edge,a.site,l.site,r);a=s[0],l=s[c-1],l.edge=h(a.site,l.site,null,r),M(a),M(l)}function m(e){for(var t,n,i,r,f=e[0],u=e[1],s=G._;s;)if(i=k(s,u)-f,i>S)s=s.L;else{if(r=f-w(s,u),!(r>S)){i>-S?(t=s.P,n=s):r>-S?(t=s,n=s.N):t=n=s;break}if(!s.R){t=s;break}s=s.R}p(e);var a=N(e);if(G.insert(t,a),t||n){if(t===n)return U(t),n=N(t.site),G.insert(a,n),a.edge=n.edge=h(t.site,a.site),M(t),void M(n);if(!n)return void(a.edge=h(t.site,a.site));U(t),U(n);var l=t.site,o=l[0],c=l[1],d=e[0]-o,v=e[1]-c,C=n.site,L=C[0]-o,R=C[1]-c,b=2*(d*R-v*L),y=d*d+v*v,x=L*L+R*R,P={x:(R*y-v*x)/b+o,y:(d*x-L*y)/b+c};g(n.edge,l,C,P),a.edge=h(l,e,null,P),n.edge=h(e,C,null,P),M(t),M(n)}}function k(e,t){var n=e.site,i=n[0],r=n[1],f=r-t;if(!f)return i;var u=e.P;if(!u)return-(1/0);n=u.site;var s=n[0],a=n[1],l=a-t;if(!l)return s;var o=s-i,h=1/f-1/l,c=o/l;return h?(-c+Math.sqrt(c*c-2*h*(o*o/(-2*l)-a+l/2+r-f/2)))/h+i:(i+s)/2}function w(e,t){var n=e.N;if(n)return k(n,t);var i=e.site;return i[1]===t?i[0]:1/0}function q(e){return e[0]}function A(e){return e[1]}function E(e){return function(){return e}}function j(e,t,n){return(e[0]-n[0])*(t[1]-e[1])-(e[0]-t[0])*(n[1]-e[1])}function z(e,t){return t[1]-e[1]||t[0]-e[0]}function B(e,n){var i,r,f,u=e.sort(z).pop();for(J=[],H=new Array(e.length),G=new t,I=new t;;)if(f=F,u&&(!f||u[1]<f.y||u[1]===f.y&&u[0]<f.x))(u[0]!==i||u[1]!==r)&&(m(u),i=u[0],r=u[1]),u=e.pop();else{if(!f)break;_(f.arc)}if(n){var s=n[0][0],a=n[0][1],l=n[1][0],o=n[1][1];C(s,a,l,o),b(s,a,l,o)}var h={cells:H,edges:J};return G=I=J=H=null,h}function D(){function e(e){return B(t(e),u)}function t(e){return e.map(function(t,n){var i=[Math.round(r(t,n,e)/S)*S,Math.round(f(t,n,e)/S)*S];return i.index=n,i.data=t,i})}var n=q,i=A,r=n,f=i,u=null;return e.cells=function(e){var n=new Array(e.length),i=u||Q,r=i[0][0],f=i[0][1],a=i[1][0],l=i[1][1];return B(t(e),i).cells.forEach(function(t,i){var u=t.halfedges,o=t.site,h=n[i]=u.length?u.map(s):o[0]>=r&&o[0]<=a&&o[1]>=f&&o[1]<=l?[[r,l],[a,l],[a,f],[r,f]]:[];h.data=e[i]}),n},e.links=function(e){return B(t(e)).edges.filter(function(e){return e.left&&e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},e.triangles=function(e){var n=[];return B(t(e)).cells.forEach(function(e,t){for(var i,r,f=e.site,u=e.halfedges.sort(o),s=-1,a=u.length,l=u[a-1].edge,h=l.left===f?l.right:l.left;++s<a;)i=l,r=h,l=u[s].edge,h=l.left===f?l.right:l.left,t<r.index&&t<h.index&&j(f,r,h)<0&&n.push([f.data,r.data,h.data])}),n},e.x=function(t){return arguments.length?(n=t,r="function"==typeof t?n:E(n),e):n},e.y=function(t){return arguments.length?(i=t,f="function"==typeof t?i:E(i),e):i},e.extent=function(t){return arguments.length?(u=null==t?null:[[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]],e):u&&[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},e.size=function(t){return arguments.length?(u=null==t?null:[[0,0],[+t[0],+t[1]]],e):u&&[u[1][0],u[1][1]]},e}t.prototype={insert:function(e,t){var n,u,s;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=f(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)u=n.U,n===u.L?(s=u.R,s&&s.C?(n.C=s.C=!1,u.C=!0,e=u):(e===n.R&&(i(this,n),e=n,n=e.U),n.C=!1,u.C=!0,r(this,u))):(s=u.L,s&&s.C?(n.C=s.C=!1,u.C=!0,e=u):(e===n.L&&(r(this,n),e=n,n=e.U),n.C=!1,u.C=!0,i(this,u))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,u,s=e.U,a=e.L,l=e.R;if(n=a?l?f(l):a:l,s?s.L===e?s.L=n:s.R=n:this._=n,a&&l?(u=n.C,n.C=e.C,n.L=a,a.U=n,n!==l?(s=n.U,n.U=e.U,e=n.R,s.L=e,n.R=l,l.U=n):(n.U=s,s=n,e=n.R)):(u=e.C,e=n),e&&(e.U=s),!u){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===s.L){if(t=s.R,t.C&&(t.C=!1,s.C=!0,i(this,s),t=s.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,r(this,t),t=s.R),t.C=s.C,s.C=t.R.C=!1,i(this,s),e=this._;break}}else if(t=s.L,t.C&&(t.C=!1,s.C=!0,r(this,s),t=s.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,i(this,t),t=s.L),t.C=s.C,s.C=t.L.C=!1,r(this,s),e=this._;break}t.C=!0,e=s,s=s.U}while(!e.C);e&&(e.C=!1)}}};var F,G,H,I,J,K=[],O=[],Q=[[-1e6,-1e6],[1e6,1e6]],S=1e-6,T=1e-12,V="0.2.1";e.version=V,e.voronoi=D});