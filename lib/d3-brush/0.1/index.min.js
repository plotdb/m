!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],e):e(t.d3_brush=t.d3_brush||{},t.d3_dispatch,t.d3_drag,t.d3_interpolate,t.d3_selection,t.d3_transition)}(this,function(t,e,n,r,s,i){"use strict";function a(t){return function(){return t}}function u(t,e,n){this.target=t,this.type=e,this.selection=n}function o(){s.event.stopImmediatePropagation()}function l(){s.event.preventDefault(),s.event.stopImmediatePropagation()}function c(t){return{type:t}}function h(){return!s.event.button}function f(){var t=this.ownerSVGElement;return[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function p(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function d(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function v(t){var e=t.__brush;return e?e.dim.output(e.selection):null}function m(){return w(z)}function b(){return w(A)}function y(){return w(q)}function w(t){function v(e){var n=e.property("__brush",g).selectAll(".overlay").data([c("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",E.overlay).merge(n).each(function(){var t=p(this).extent;s.select(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])}),e.selectAll(".selection").data([c("selection")]).enter().append("rect").attr("class","selection").attr("cursor",E.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var r=e.selectAll(".handle").data(t.handles,function(t){return t.type});r.exit().remove(),r.enter().append("rect").attr("class",function(t){return"handle handle--"+t.type}).attr("cursor",function(t){return E[t.type]}),e.each(m).attr("fill","none").attr("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush touchstart.brush",w)}function m(){var t=s.select(this),e=p(this).selection;e?(t.selectAll(".selection").style("display",null).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1]),t.selectAll(".handle").style("display",null).attr("x",function(t){return"e"===t.type[t.type.length-1]?e[1][0]-P/2:e[0][0]-P/2}).attr("y",function(t){return"s"===t.type[0]?e[1][1]-P/2:e[0][1]-P/2}).attr("width",function(t){return"n"===t.type||"s"===t.type?e[1][0]-e[0][0]+P:P}).attr("height",function(t){return"e"===t.type||"w"===t.type?e[1][1]-e[0][1]+P:P})):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function b(t,e){return t.__brush.emitter||new y(t,e)}function y(t,e){this.that=t,this.args=e,this.state=t.__brush,this.active=0}function w(){function e(){var t=s.mouse(Y);!$||N||X||(Math.abs(t[0]-et[0])>Math.abs(t[1]-et[1])?X=!0:N=!0),et=t,G=!0,l(),r()}function r(){var t;switch(P=et[0]-tt[0],j=et[1]-tt[1],F){case x:case _:H&&(P=Math.max(R-h,Math.min(W-w,P)),f=h+P,g=w+P),J&&(j=Math.max(U-v,Math.min(Z-C,j)),y=v+j,I=C+j);break;case M:0>H?(P=Math.max(R-h,Math.min(W-h,P)),f=h+P,g=w):H>0&&(P=Math.max(R-w,Math.min(W-w,P)),f=h,g=w+P),0>J?(j=Math.max(U-v,Math.min(Z-v,j)),y=v+j,I=C):J>0&&(j=Math.max(U-C,Math.min(Z-C,j)),y=v,I=C+j);break;case k:H&&(f=Math.max(R,Math.min(W,h-P*H)),g=Math.max(R,Math.min(W,w+P*H))),J&&(y=Math.max(U,Math.min(Z,v-j*J)),I=Math.max(U,Math.min(Z,C+j*J)))}f>g&&(H*=-1,t=h,h=w,w=t,t=f,f=g,g=t,B in K&&st.attr("cursor",E[B=K[B]])),y>I&&(J*=-1,t=v,v=C,C=t,t=y,y=I,I=t,B in S&&st.attr("cursor",E[B=S[B]])),N&&(f=Q[0][0],g=Q[1][0]),X&&(y=Q[0][1],I=Q[1][1]),Q[0][0]===f&&Q[0][1]===y&&Q[1][0]===g&&Q[1][1]===I||(Q[0][0]=f,Q[0][1]=y,Q[1][0]=g,Q[1][1]=I,m.call(Y),nt.brush())}function a(){if(o(),s.event.touches){if(s.event.touches.length)return;q&&clearTimeout(q),q=setTimeout(function(){q=null},500),rt.on("touchmove.brush touchend.brush touchcancel.brush",null)}else n.dragEnable(s.event.view,G),it.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);rt.attr("pointer-events","all"),st.attr("cursor",E.overlay),d(Q)&&(L.selection=null,m.call(Y)),nt.end()}function u(){switch(s.event.keyCode){case 16:$=H&&J;break;case 18:F===M&&(H&&(w=g-P*H,h=f+P*H),J&&(C=I-j*J,v=y+j*J),F=k,r());break;case 32:F!==M&&F!==k||(0>H?w=g-P:H>0&&(h=f-P),0>J?C=I-j:J>0&&(v=y-j),F=x,st.attr("cursor",E.selection),r());break;default:return}l()}function c(){switch(s.event.keyCode){case 16:$&&(N=X=$=!1,r());break;case 18:F===k&&(0>H?w=g:H>0&&(h=f),0>J?C=I:J>0&&(v=y),F=M,r());break;case 32:F===x&&(s.event.altKey?(H&&(w=g-P*H,h=f+P*H),J&&(C=I-j*J,v=y+j*J),F=k):(0>H?w=g:H>0&&(h=f),0>J?C=I:J>0&&(v=y),F=M),st.attr("cursor",E[B]),r());break;default:return}l()}if(s.event.touches){if(s.event.changedTouches.length<s.event.touches.length)return l()}else if(q)return;if(D.apply(this,arguments)){var h,f,v,y,w,g,C,I,P,j,G,N,X,Y=this,B=s.event.target.__data__.type,F="selection"===(s.event.metaKey?B="overlay":B)?_:s.event.altKey?k:M,H=t===A?null:T[B],J=t===z?null:V[B],L=p(Y),O=L.extent,Q=L.selection,R=O[0][0],U=O[0][1],W=O[1][0],Z=O[1][1],$=H&&J&&s.event.shiftKey,tt=s.mouse(Y),et=tt,nt=b(Y,arguments).beforestart();"overlay"===B?L.selection=Q=[[h=t===A?R:tt[0],v=t===z?U:tt[1]],[w=t===A?W:h,C=t===z?Z:v]]:(h=Q[0][0],v=Q[0][1],w=Q[1][0],C=Q[1][1]),f=h,y=v,g=w,I=C;var rt=s.select(Y).attr("pointer-events","none"),st=rt.selectAll(".overlay").attr("cursor",E[B]);if(s.event.touches)rt.on("touchmove.brush",e,!0).on("touchend.brush touchcancel.brush",a,!0);else{var it=s.select(s.event.view).on("keydown.brush",u,!0).on("keyup.brush",c,!0).on("mousemove.brush",e,!0).on("mouseup.brush",a,!0);n.dragDisable(s.event.view)}o(),i.interrupt(Y),m.call(Y),nt.start()}}function g(){var e=this.__brush||{selection:null};return e.extent=C.apply(this,arguments),e.dim=t,e}var q,C=f,D=h,I=e.dispatch(v,"start","brush","end"),P=6;return v.move=function(e,n){e.selection?e.on("start.brush",function(){b(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){b(this,arguments).end()}).tween("brush",function(){function e(t){i.selection=1===t&&d(o)?null:l(t),m.call(s),a.brush()}var s=this,i=s.__brush,a=b(s,arguments),u=i.selection,o=t.input("function"==typeof n?n.apply(this,arguments):n,i.extent),l=r.interpolate(u,o);return u&&o?e:e(1)}):e.each(function(){var e=this,r=arguments,s=e.__brush,a=t.input("function"==typeof n?n.apply(e,r):n,s.extent),u=b(e,r).beforestart();i.interrupt(e),s.selection=null==a||d(a)?null:a,m.call(e),u.start().brush().end()})},y.prototype={beforestart:function(){return 1===++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting&&(this.starting=!1,this.emit("start")),this},brush:function(){return this.emit("brush"),this},end:function(){return 0===--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(e){s.customEvent(new u(v,e,t.output(this.state.selection)),I.apply,I,[e,this.that,this.args])}},v.extent=function(t){return arguments.length?(C="function"==typeof t?t:a([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),v):C},v.filter=function(t){return arguments.length?(D="function"==typeof t?t:a(!!t),v):D},v.handleSize=function(t){return arguments.length?(P=+t,v):P},v.on=function(){var t=I.on.apply(I,arguments);return t===I?v:t},v}var g="0.1.6",_={name:"drag"},x={name:"space"},M={name:"handle"},k={name:"center"},z={name:"x",handles:["e","w"].map(c),input:function(t,e){return t&&[[t[0],e[0][1]],[t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},A={name:"y",handles:["n","s"].map(c),input:function(t,e){return t&&[[e[0][0],t[0]],[e[1][0],t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},q={name:"xy",handles:["n","e","s","w","nw","ne","se","sw"].map(c),input:function(t){return t},output:function(t){return t}},E={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},K={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},S={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},T={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},V={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};t.version=g,t.brush=y,t.brushX=m,t.brushY=b,t.brushSelection=v});