!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.d3_quadtree=t.d3_quadtree||{})}(this,function(t){"use strict";function i(t){if(isNaN(n=+t[0])||isNaN(r=+t[1]))return this;this.cover(n,r);var i,n,r,o,e,s,h,u,_,p,f,a=this._root,x=this._x0,y=this._y0,c=this._x1,w=this._y1;if(!a)return this._root={point:t},this;for(;!a.point;)if((u=n>=(o=(x+c)/2))?x=o:c=o,(_=r>=(e=(y+w)/2))?y=e:w=e,i=a,!(a=a[p=_<<1|u]))return i[p]={point:t},this;if(s=a.point[0],h=a.point[1],n===s&&r===h)return a={point:t,next:a},i?i[p]=a:this._root=a,this;do i=i?i[p]=new Array(4):this._root=new Array(4),(u=n>=(o=(x+c)/2))?x=o:c=o,(_=r>=(e=(y+w)/2))?y=e:w=e;while((p=_<<1|u)===(f=(h>=e)<<1|s>=o));return i[p]={point:t},i[f]=a,this}function n(t,i){if(isNaN(t=+t)||isNaN(i=+i))return this;var n,r,o=this._root,e=this._x0,s=this._y0,h=this._x1,u=this._y1,_=h-e;if(isNaN(e))e=h=t,s=u=i;else if(e>t||t>h||s>i||i>u)if(_){switch(r=((s+u)/2>i)<<1|(e+h)/2>t){case 0:do n=new Array(4),n[r]=o,o=n;while(_*=2,h=e+_,u=s+_,t>h||i>u);break;case 1:do n=new Array(4),n[r]=o,o=n;while(_*=2,e=h-_,u=s+_,e>t||i>u);break;case 2:do n=new Array(4),n[r]=o,o=n;while(_*=2,h=e+_,s=u-_,t>h||s>i);break;case 3:do n=new Array(4),n[r]=o,o=n;while(_*=2,e=h-_,s=u-_,e>t||s>i)}this._root&&!this._root.point&&(this._root=o)}else{s>i?s=i:u=i,e>t?e=t:h=t;var p=h-e,f=u-s;f>p?h=(e-=(f-p)/2)+f:u=(s-=(p-f)/2)+p}return this._x0=e,this._y0=s,this._x1=h,this._y1=u,this}function r(){return isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function o(t,i,n,r,o){this.node=t,this.x0=i,this.y0=n,this.x1=r,this.y1=o}function e(t,i){var n,r,e,s,h,u,_,p=1/0,f=this._x0,a=this._y0,x=this._x1,y=this._y1,c=[],w=this._root;for(w&&c.push(new o(w,f,a,x,y));u=c.pop();)if(w=u.node,r=u.x0,e=u.y0,s=u.x1,h=u.y1,!(!w||r>x||e>y||f>s||a>h)){if(w.point){var v=t-w.point[0],d=i-w.point[1],N=v*v+d*d;if(p>N){var l=Math.sqrt(p=N);f=t-l,a=i-l,x=t+l,y=i+l,n=w.point}}var A=(r+s)/2,g=(e+h)/2;c.push(new o(w[3],A,g,s,h),new o(w[2],r,g,A,h),new o(w[1],A,e,s,g),new o(w[0],r,e,A,g)),(_=(i>=g)<<1|t>=A)&&(u=c[c.length-1],c[c.length-1]=c[c.length-1-_],c[c.length-1-_]=u)}return n}function s(){var t=[];return this.visit(function(i){if(i.point)do t.push(i.point);while(i=i.next)}),t}function h(t){var i,n,r,o,e,s,h,u,_,p=this._root,f=+t[0],a=+t[1],x=this._x0,y=this._y0,c=this._x1,w=this._y1;if(!p)return!1;if(!p.point)for(;;){if((s=f>=(o=(x+c)/2))?x=o:c=o,(h=a>=(e=(y+w)/2))?y=e:w=e,i=p,!(p=p[u=h<<1|s]))return!1;if(p.point)break;(i[u+1&3]||i[u+2&3]||i[u+3&3])&&(n=i,_=u)}for(;p.point!==t;)if(r=p,!(p=p.next))return!1;return r?(r.next=p.next,!0):i?(i[u]=p.next,(p=i[0]||i[1]||i[2]||i[3])&&p===(i[3]||i[2]||i[1]||i[0])&&p.point&&(n?n[_]=p:this._root=p),!0):(this._root=p.next,!0)}function u(){return this._root}function _(){var t=0;return this.visit(function(i){if(i.point)do++t;while(i=i.next)}),t}function p(t){var i,n,r,e,s,h,u=[],_=this._root;for(_&&u.push(new o(_,this._x0,this._y0,this._x1,this._y1));i=u.pop();)if(!t(_=i.node,r=i.x0,e=i.y0,s=i.x1,h=i.y1)){var p=(r+s)/2,f=(e+h)/2;(n=_[3])&&u.push(new o(n,p,f,s,h)),(n=_[2])&&u.push(new o(n,r,f,p,h)),(n=_[1])&&u.push(new o(n,p,e,s,f)),(n=_[0])&&u.push(new o(n,r,e,p,f))}return this}function f(t){var i,n=[],r=[];for(this._root&&n.push(new o(this._root,this._x0,this._y0,this._x1,this._y1));i=n.pop();){var e,s=i.node,h=i.x0,u=i.y0,_=i.x1,p=i.y1,f=(h+_)/2,a=(u+p)/2;(e=s[0])&&n.push(new o(e,h,u,f,a)),(e=s[1])&&n.push(new o(e,f,u,_,a)),(e=s[2])&&n.push(new o(e,h,a,f,p)),(e=s[3])&&n.push(new o(e,f,a,_,p)),r.push(i)}for(;i=r.pop();)t(i.node,i.x0,i.y0,i.x1,i.y1);return this}function a(t){var i=new x(NaN,NaN,NaN,NaN);return t?i.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):i}function x(t,i,n,r){this._x0=t,this._y0=i,this._x1=n,this._y1=r,this._root=void 0}function y(){var t,i,n=new x(this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(r.point)return n._root=c(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var o=0;4>o;++o)(i=r.source[o])&&(i.point?r.target[o]=c(i):t.push({source:i,target:r.target[o]=new Array(4)}));return n}function c(t){for(var i={point:t.point},n=i;t=t.next;)n=n.next={point:t.point};return i}var w="0.5.0",v=x.prototype=a.prototype;v.add=i,v.copy=y,v.cover=n,v.extent=r,v.find=e,v.points=s,v.remove=h,v.root=u,v.size=_,v.visit=p,v.visitAfter=f,t.version=w,t.quadtree=a});